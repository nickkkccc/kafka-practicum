# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2

## –û–ø–∏—Å–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ü—Ä–æ–µ–∫—Ç —É—Ä–æ–∫–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:

```plaintext
üìÇL2/
‚îú‚îÄ  üìÇdocker/
‚îÇ     ‚îî‚îÄ  docker-compose.yml <1>
‚îú‚îÄ  Makefile <2>
‚îú‚îÄ  Readme.adoc <3>
‚îú‚îÄ  pom.xml
‚îú‚îÄ  üìÇsrc/main/java
‚îÇ     ‚îú‚îÄ  üìÇconsumer/
‚îÇ     ‚îÇ     ‚îú‚îÄ  AbstractConsumerSettings.java
‚îÇ     ‚îÇ     ‚îú‚îÄ  üìÇbatch/
‚îÇ     ‚îÇ     ‚îÇ     ‚îú‚îÄ  BatchConsumer.java <4>
‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ  ConsumerSettings.java
‚îÇ     ‚îÇ     ‚îî‚îÄ  üìÇsingle.message/
‚îÇ     ‚îÇ           ‚îú‚îÄ  SingleMessageConsumer.java <5>
‚îÇ     ‚îÇ           ‚îî‚îÄ  ConsumerSettings.java
‚îÇ     ‚îú‚îÄ  üìÇpojo/
‚îÇ     ‚îÇ     ‚îî‚îÄ  User.java <6>
‚îÇ     ‚îú‚îÄ  üìÇproducer/
‚îÇ     ‚îÇ     ‚îú‚îÄ  Producer.java <7>
‚îÇ     ‚îÇ     ‚îî‚îÄ  ProducerSettings.java
‚îÇ     ‚îî‚îÄ  Constants.java
```

1. –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö, –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Ä–æ–∫–∞
2. `Makefile`, —É–ø—Ä–æ—â–∞—é—â–∏–π —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
3. –¢–µ–∫—É—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `BatchConsumer`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –º–µ–Ω–µ–µ 10 —à—Ç., –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–º–µ—â–µ–Ω–∏–µ
   –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ–≥–æ –Ω–∞–±–æ—Ä–∞
5. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `SingleMessageConsumer`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–º–µ—â–µ–Ω–∏—è
   –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
6. –ö–ª–∞—Å—Å pojo, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
7. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `Producer`, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è `User` –≤ kafka —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º
   rps.

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### Producer

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–º `User` –≤ —Ñ–æ—Ä–º–∞—Ç–µ cbor, –≤ kafka.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–¥–∞–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ env:

- `bootstrap.servers` - –∞–¥—Ä–µ—Å–∞ –±—Ä–æ–∫–µ—Ä–æ–≤ kafka, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
- `rps` - rps, —Å –∫–æ—Ç–æ—Ä—ã–º, –≤ —Å—Ä–µ–¥–Ω–µ–º, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ kafka. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0.5`
- `records.count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω–æ
  –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `100`

### SingleMessageConsumer

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–±–∏—Ä–∞–µ—Ç –∏–∑ kafka —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é
—Å–º–µ—â–µ–Ω–∏–π.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–¥–∞–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ env:

- `bootstrap.servers` - –∞–¥—Ä–µ—Å–∞ –±—Ä–æ–∫–µ—Ä–æ–≤ kafka, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
- `poll.timeout` - –ø–∞—Ä–∞–º–µ—Ç—Ä, –∑–∞–¥–∞–≤–∞–µ–º—ã–π –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –º–µ—Ç–æ–¥–∞ `poll(Duration timeout)`
- `group.id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã `consumer`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `consumer-<random-uuid>`

### BatchConsumer

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–±–∏—Ä–∞–µ—Ç –∏–∑ kafka –Ω–∞–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–æ—Å–ª–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ä—É—á–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è —Å–º–µ—â–µ–Ω–∏–π.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–¥–∞–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ env:

- `bootstrap.servers` - –∞–¥—Ä–µ—Å–∞ –±—Ä–æ–∫–µ—Ä–æ–≤ kafka, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
- `poll.timeout` - –ø–∞—Ä–∞–º–µ—Ç—Ä, –∑–∞–¥–∞–≤–∞–µ–º—ã–π –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –º–µ—Ç–æ–¥–∞ `poll(Duration timeout)`
- `group.id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã `consumer`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `consumer-<random-uuid>`
- `fetch.max.wait.ms` - –≤—Ä–µ–º—è –≤ –º—Å, –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—Ä–æ–∫–µ—Ä –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è
  –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π-–±–∞–π—Ç–æ–≤. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –±—Ä–æ–∫–µ—Ä –æ—Ç–¥–∞—Å—Ç —Å—Ç–æ–ª—å–∫–æ –±–∞–π—Ç, —Å–∫–æ–ª—å–∫–æ
  –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–æ–º, –µ—Å–ª–∏ `fetch.min.bytes` –Ω–µ –±—ã–ª –¥–æ —Å–∏—Ö –ø–æ—Ä –Ω–∞–∫–æ–ø–ª–µ–Ω
- `fetch.min.bytes` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç, –∫–æ—Ç–æ—Ä–æ–µ –∫–ª–∏–µ–Ω—Ç –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ç –±—Ä–æ–∫–µ—Ä–∞

### –ó–∞–ø—É—Å–∫ —Å—Ç–µ–Ω–¥–∞

- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:

```shell
./mvnw clean package -Pproducer
```

```shell
./mvnw clean package -Psingle-message-consumer
```

```shell
./mvnw clean package -Pbatch-consumer
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–∏ docker-–æ–±—Ä–∞–∑–∞ (—á–µ—Ä–µ–∑ jib maven plugin):

```plaintext
‚ûú L2 (main) ‚úó docker images | grep "lesson"
lesson-2-batch-consumer latest  <some-hash>   56 years ago 291MB
lesson-2-producer latest  <some-hash>   56 years ago 291MB
lesson-2-single-message-consumer latest  <some-hash>   56 years ago 291MB
```

- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç–µ–Ω–¥:

```shell
cd L2 && make run
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

- –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ `lesson-2` (`partitions=3`, `replication-factor=2`) –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è (–∫–æ–º–∞–Ω–¥—ã –∏
  –≤—ã–≤–æ–¥ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ bash-–ª–æ–≥–∞—Ö)
- –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `lesson-2-producer` (`replicas=2`)
- –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `lesson-2-single-message-consumer` (`replicas=2`)
- –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `lesson-2-batch-consumer` (`replicas=2`)

## –í—ã–≤–æ–¥ –ø–æ –∑–∞–¥–∞–Ω–∏—é

### SingleMessageConsumer

–í –¥–∞–Ω–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞ —Ä–∞–∑ –∏ –¥–µ–ª–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é
—Ñ–∏–∫—Å–∞—Ü–∏—é —Å–º–µ—â–µ–Ω–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `enable.auto.commit==true` - –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é.
- `max.poll.records==1` - –≤—ã—Å—Ç–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ 1 –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª-–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å

### BatchConsumer

–í –¥–∞–Ω–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –ø–∞—á–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞ –æ–¥–∏–Ω
–∑–∞–ø—Ä–æ—Å (–≤ –∑–∞–¥–∞–Ω–∏–∏ –Ω–µ –º–µ–Ω–µ–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Kafka (–≤ —Ä–µ—à–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `rps` –≤ `Producer`)
- `fetch.max.wait.ms` - –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ `poll timeout` –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–∏ '—Ö–æ–ª–æ—Å—Ç—ã—Ö' –∑–∞–ø—Ä–æ—Å–æ–≤
- `fetch.min.bytes` - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π), —á—Ç–æ–±—ã
  –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö `fetch.max.wait.ms` –∏ `poll timeout` –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –Ω–µ –¥–µ–ª–∞–ª '—Ö–æ–ª–æ—Å—Ç—ã—Ö' –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ
  –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ `fetch.max.wait.ms` –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–æ—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–π—Ç. –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –±—É–¥–µ—Ç –∏–º–µ—Ç—å
  –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–µ—Ç
  `< —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª-–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π`
